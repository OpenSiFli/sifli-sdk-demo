# 屏幕模组调试程序

## 支持的平台
<!-- 支持哪些板子和芯片平台 -->
+ sf32lb52-lcd_n16r8

## SiFli-SDK版本
选择SDK版本v2.4.2或更高

## 概述
这个是一个基于`GC9107`屏驱为基础的，多个`128*128`的`ZJY085-1212TBWIG42`屏幕组合成一个大的屏幕。可以实现每个屏幕显示内容不同，同时可以随意组合屏幕，比如六个屏幕，可以2x3,3x2,1x6等进行排列组合显示不同内容。主要的修改屏驱内容请查看[屏驱修改介绍](gc9107_Multi_screen\README.md)<br>
适用于屏幕驱动以及触控驱动的调试和测试。
这是基于rt-thread的rt driver驱动框架的屏幕刷新显示，以及触控的数据读取打印程序。
屏幕上能看到每3秒钟变化一次显示内容：
- Color bar  8种渐变色（白色、灰色、红、绿、蓝、青色、紫色、黄色），每种渐变色都从黑色逐渐过渡而来。
- 纵向灰度渐变色（ 每256行循环1次）
- 纯色(红、绿、蓝、白、黑色)


## 目录结构介绍
主要介绍当前工程目录下的所存放和实现的内容，以便于更好的理解文档
```
multi-screen_gif                #实现多个屏幕显示GIF动画
│
├──gc9107_Multi_screen          #屏幕屏驱     
│   ├──assets                   #存放readme内的图片
│   ├──gc9107_Multi_screen.c    #屏驱的实现
│   ├──README.md                #屏驱代码介绍
│   └──SConscript               #编译链接文件
│    
├──project                      #屏幕模组的menuconfig菜单定义和屏驱IC宏定义以及编译文件存放处
│   
├──src
│   ├──main                     #屏幕实现
│   └──SConscript               #编译链接文件
│ 
└──README.md                    #多个屏幕显示GIF动画内容讲解
```

## 硬件需求
运行该例程前，需要准备一块本例程支持的开发板
如下以六个屏幕为例，屏幕与开发板的连线和引脚说明<br>
所有屏幕相同引脚全部与开发板对应引脚相连(进行串行连接)：
|开发板引脚|屏幕引脚  |
|:---|:---|  
|GND      |GND|   
|VCC(3.3) |VCC|  
|PA04     |SCL|   
|PA05     |SDA|  
|PA00     |RST|  
|PA06     |DC |   
|VCC      |BL |  

各个屏幕的 CS 引脚分别与开发板对应GPIO引脚相连（可以自行添加或者减少屏幕）：  
|屏幕|LCD1 |LCD2 |LCD3 |LCD4 |LCD5 |LCD6 | ···  |    
|:---|:---|:---|:---|:---|:---|:---|:---| 
|CS与开发板引脚 |PA03 |PA25 |PA29 |PA37 |PA38 |PA24 |···  |  



## main函数
main函数创建了2个线程：
- LCD屏幕的刷新线程
- 触控读取线程


### 1. LCD屏幕的刷新线程
1. 打开lcd rt device
2. 获取搜索到的屏幕信息，并打印其宽度、高度、设置的颜色位深、刷屏的像素对齐要求信息
3. 填充framebuffer(见概述描述)
4. 将framebufer刷到屏幕上
5. 等刷屏完成后，设置背光亮度
6. 等待3秒钟
7. 如果是ramless屏幕，切换到另外一个framebuffer
8. 跳到第3步

#### framebuffer相关
颜色格式定义 FB_COLOR_FORMAT 默认是24bit
颜色格式的每个像素字节数 FB_PIXEL_BYTES  默认是3

ramless屏幕为了防止填充的时候，framebuffer被刷新，所以定义了framebuffer2，在显示的时候会交替使用，防止填充和刷屏冲突。

### 2. 触控读取线程
1. 打开touch rt device，
2. 设置触控中断触发函数tp_rx_indicate，去释放信号量
3. 在while循环里面如果拿到了信号量，就去读取触控数据，并将其打印在串口上。